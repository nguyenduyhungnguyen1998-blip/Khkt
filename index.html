<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tam ThÃ¡i Tá»­</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="stylesen1.css">
<link rel="manifest" href="manifest.json">
</head>
<body>
  <div id="greetingPopup" class="fullscreen-overlay" role="dialog" aria-modal="true" aria-labelledby="greetingTitle">
    <div class="box">
      <h2 id="greetingTitle" style="margin:0">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ¡p HÃ  Ná»™i!</h2>
      <div style="color:var(--muted);margin-top:8px">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, báº¡n cÃ³ muá»‘n báº­t nháº¡c ná»n khÃ´ng?</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="musicYes" class="btn">CÃ³, báº­t nháº¡c</button>
        <button id="musicNo" class="ghost">KhÃ´ng, cáº£m Æ¡n</button>
      </div>
    </div>
  </div>

  <div id="modeSelect" class="fullscreen-overlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
    <div class="box">
      <h2 id="modeTitle" style="margin:0">Chá»n cháº¿ Ä‘á»™</h2>
      <div style="color:var(--muted);margin-top:8px">Báº¯t Ä‘áº§u báº±ng cÃ¡ch chá»n má»™t cháº¿ Ä‘á»™. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i sau.</div>
      <div class="mode-grid" role="list">
        <button class="mode-card" id="mode-play" role="listitem"><h3>ğŸ® Play</h3><p>ChÆ¡i tá»± do: kÃ©o tháº£, tÃ­nh giá», lÆ°u ká»· lá»¥c.</p></button>
        <button class="mode-card" id="mode-teach" role="listitem"><h3>ğŸ“ Teach</h3><p>Há»c cÃ¡ch giáº£i. Game sáº½ gá»£i Ã½ vÃ  chá» báº¡n Ä‘i Ä‘Ãºng.</p></button>
        <button class="mode-card" id="mode-learn" role="listitem"><h3>ğŸ§  Learn (Äá»‡ quy)</h3><p>Trá»±c quan hÃ³a thuáº­t toÃ¡n, call stack & tá»«ng bÆ°á»›c.</p></button>
        <button class="mode-card" id="mode-challenge" role="listitem"><h3>â±ï¸ Challenge</h3><p>HoÃ n thÃ nh trong thá»i háº¡n. 3 cáº¥p Ä‘á»™ Dá»…/Vá»«a/KhÃ³.</p></button>
        <button class="mode-card" id="mode-sandbox" role="listitem"><h3>ğŸš€ Sandbox</h3><p>TÃ¹y chá»‰nh sá»‘ cá»™t vÃ  luáº­t chÆ¡i cá»§a riÃªng báº¡n.</p></button>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:center"><button id="modeStart" class="btn">XÃ¡c nháº­n</button></div>
    </div>
  </div>
  
  <div id="sandboxSetupPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="sandboxTitle">
        <div class="popup-box wide sandbox-lab">
            <h3 id="sandboxTitle" style="margin-top:0">ğŸš€ Sandbox Custom Lab</h3>
            <p style="color:var(--muted);margin:4px 0 16px;">Thiáº¿t káº¿ mÃ n chÆ¡i ThÃ¡p HÃ  Ná»™i cá»§a riÃªng báº¡n.</p>
            
            <div class="lab-section">
                <h4>Cáº¥u hÃ¬nh CÆ¡ báº£n</h4>
                <div class="lab-controls-grid">
                    <div class="lab-control">
                        <label for="sandboxDisks">Sá»‘ Ä‘Ä©a: <span id="sandboxDisksValue">4</span></label>
                        <input type="range" id="sandboxDisks" min="2" max="8" value="4">
                    </div>
                    <div class="lab-control">
                        <label for="sandboxPoles">Sá»‘ cá»™t: <span id="sandboxPolesValue">4</span></label>
                        <input type="range" id="sandboxPoles" min="3" max="6" value="4">
                    </div>
                </div>
              </div>
            
            <div class="lab-section">
                <h4>Luáº­t chÆ¡i & Má»¥c tiÃªu</h4>
                <div class="lab-controls-grid">
                    <div class="lab-control">
                         <label for="sandboxRule">Quy táº¯c di chuyá»ƒn:</label>
                         <select id="sandboxRule">
                            <option value="classic">Cá»• Ä‘iá»ƒn (KhÃ´ng giá»›i háº¡n)</option>
                            <option value="cyclic">Tuáº§n hoÃ n (Má»™t chiá»u)</option>
                            <option value="adjacent">Liá»n ká» (Hai chiá»u)</option>
                        </select>
                        <p id="sandboxRuleDesc" class="rule-desc">Di chuyá»ƒn Ä‘Ä©a tá»± do, miá»…n lÃ  Ä‘Ä©a nhá» hÆ¡n á»Ÿ trÃªn.</p>
                    </div>
                    <div class="lab-control">
                         <label for="sandboxStartPos">Vá»‹ trÃ­ ban Ä‘áº§u:</label>
                         <select id="sandboxStartPos">
                            <option value="classic">Cá»• Ä‘iá»ƒn (Táº¥t cáº£ á»Ÿ Cá»™t 1)</option>
                            <option value="spread">Tráº£i Ä‘á»u (1 Ä‘Ä©a/cá»™t)</option>
                            <option value="last_pole">Äáº£o ngÆ°á»£c (Táº¥t cáº£ á»Ÿ Cá»™t cuá»‘i)</option>
                        </select>
                        <p class="rule-desc">ÄÄ©a sáº½ Ä‘Æ°á»£c sáº¯p xáº¿p ban Ä‘áº§u nhÆ° tháº¿ nÃ o.</p>
                    </div>
                    <div class="lab-control">
                         <label for="sandboxTarget">Má»¥c tiÃªu chiáº¿n tháº¯ng:</label>
                         <select id="sandboxTarget">
                            <option value="any_other">HoÃ n thÃ nh á»Ÿ báº¥t ká»³ cá»™t nÃ o (trá»« cá»™t 1)</option>
                            <option value="last_pole">Chá»‰ hoÃ n thÃ nh á»Ÿ cá»™t cuá»‘i cÃ¹ng</option>
                        </select>
                        <p class="rule-desc">Äiá»u kiá»‡n Ä‘á»ƒ tÃ­nh lÃ  chiáº¿n tháº¯ng.</p>
                    </div>
                </div>
            </div>

            <div class="popup-actions">
                <button id="sandboxStart" class="btn">Báº¯t Ä‘áº§u ThÃ­ nghiá»‡m</button>
            </div>
        </div>
    </div>


  <div class="app" id="app">
    <div class="header">
      <h1>Brahma Tower</h1>
      <div id="titleDisplayContainer" class="title-container">
        <span id="titleDisplay" class="title-badge" title="Click Ä‘á»ƒ xem vÃ  Ä‘á»•i danh hiá»‡u">TÃ¢n Binh</span>
      </div>
      <div class="kv" style="margin-left: 12px; font-weight: 600;">Mode: <span id="currentModeDisplay" style="color: var(--accent);">Play</span></div>
      <div class="topmeta">
        <div class="badge">Moves: <span id="mv" aria-live="polite">0</span></div>
        <div id="best-score-display" class="badge">Best (<span id="best-n">4</span> Ä‘Ä©a): <span id="best">â€”</span></div>
        <div id="sandbox-status" class="badge" style="display: none;">Sandbox Mode</div>
        <div class="badge">Time: <span id="tm" aria-live="polite">00:00</span></div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <label>Sá»‘ Ä‘Ä©a: <input id="n" type="number" min="1" max="8" value="4"></label>
        <label>Theme:
          <select id="theme" class="theme-select">
            <option value="classic">âœ¨ Classic</option><option value="burger">ğŸ” Burger</option><option value="rescue">ğŸ± MÃ¨o</option><option value="neon">ğŸŒˆ Neon</option><option value="dark">ğŸŒ™ Dark Cozy</option>
          </select>
        </label>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
             <label class="kv">Ã‚m: <input id="snd" type="checkbox" checked></label>
             <button id="settingsBtn" class="ghost" style="padding: 6px 10px; line-height: 1;" title="CÃ i Ä‘áº·t Ã‚m thanh">âš™ï¸</button>
        </div>
      </div>

      <div class="row" style="align-items:center">
        <label id="speedLabel" style="display: none;">Tá»‘c Ä‘á»™ (Auto/Learn):
          <select id="spd" class="speed-select"><option value="1200">Cháº­m</option><option value="700" selected>Vá»«a</option><option value="300">Nhanh</option></select>
        </label>
        <button class="btn" id="reset">Reset</button>
        <button class="ghost" id="changeMode">Äá»•i Cháº¿ Ä‘á»™</button>
        <button class="ghost" id="undo" disabled>Undo</button>
        <button class="ghost" id="auto">Auto-solve</button>
        <button class="ghost" id="hint">Gá»£i Ã½</button>
        <button class="ghost" id="analysisBtn">ğŸ† Leaderboard</button>
        <span id="sbInline" style="display:none;align-items:center;gap:8px">
          <label>Báº¯t Ä‘áº§u:
            <select id="sbStartInline" class="speed-select"></select>
          </label>
          <label>ÄÃ­ch:
            <select id="sbTargetInline" class="speed-select"></select>
          </label>
          <label>Luáº­t:
            <select id="sbRuleInline" class="speed-select">
              <option value="classic">Classic</option>
              <option value="adjacent">Adjacent</option>
              <option value="cyclic">Cyclic</option>
            </select>
          </label>
          <span id="sbFsInfo" class="kv" style="margin-left:8px;display:none"></span>
        </span>
        <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
          <div class="progress" title="Tiáº¿n Ä‘á»™"><i id="prog"></i></div>
          <div class="hud"><div class="kv">HÆ°á»›ng dáº«n: <span id="hintText" aria-live="polite">â€”</span></div></div>
        </div>
      </div>
    </div>

    <div class="wrap-stage" id="stage">
      </div>
    <div class="footerNote">Máº¹o: KÃ©o tháº£ hoáº·c dÃ¹ng phÃ­m sá»‘ (1, 2, 3...) Ä‘á»ƒ chá»n cá»c vÃ  di chuyá»ƒn Ä‘Ä©a. Nháº¥n 'Esc' Ä‘á»ƒ há»§y.</div>
  </div>

  <div id="finish" class="finishPop"></div>
  
  <div id="errorPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="errorTitle">
    <div class="popup-box error-box">
      <div id="errorTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">âš ï¸ Di chuyá»ƒn khÃ´ng há»£p lá»‡!</div>
      <p id="errorPopupText" style="color:var(--muted);margin:0">KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá» hÆ¡n.</p>
      <div class="popup-actions"><button id="errorConfirm" class="btn">Hiá»ƒu rá»“i</button></div>
    </div>
  </div>

  <div id="hintPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="hintTitle">
    <div class="popup-box">
      <h3 id="hintTitle" style="margin-top:0">ğŸ’¡ Gá»£i Ã½</h3>
      <div id="hintTextPopup" style="text-align:left;margin:12px 0;line-height:1.6"></div>
      <div class="popup-actions"><button id="hintClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>

  <!-- Win Celebration Popups -->
  <div id="winPerfect" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-perfect">
      <div style="font-size:56px;margin-bottom:8px;line-height:1">ğŸ¯ğŸ†</div>
      <h3 style="margin:0 0 6px 0;color:#2b8cff;font-size:22px;font-weight:900">FLAWLESS!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:14px">âš¡ Äá»‰nh cao kÄ© thuáº­t!</p>
      <div style="font-weight:700;font-size:16px;margin:10px 0;color:#1f6ed6" id="winPerfectStats"></div>
      <div class="popup-actions"><button id="winPerfectClose" class="btn">ğŸš€ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <div id="winGood" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-good">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸŒŸğŸ‘</div>
      <h3 style="margin:0 0 6px 0;color:#28a745;font-size:20px;font-weight:800">Xuáº¥t sáº¯c!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:14px">ğŸ”¥ Cáº­n ká» hoÃ n háº£o!</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#1e7e34" id="winGoodStats"></div>
      <div class="popup-actions"><button id="winGoodClose" class="btn">âœ¨ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <div id="winSuccess" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-success">
      <div style="font-size:48px;margin-bottom:8px;line-height:1">âœ…ğŸ‰</div>
      <h3 style="margin:0 0 6px 0;color:#4b5563;font-size:19px;font-weight:700">HoÃ n thÃ nh!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ‘ Tá»‘t láº¯m!</p>
      <div style="font-weight:600;font-size:14px;margin:10px 0;color:#6b7280" id="winSuccessStats"></div>
      <div class="popup-actions"><button id="winSuccessClose" class="btn">âœ“ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <!-- Auto-solve Completion Popup -->
  <div id="winAutoSolve" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-auto">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ¤–ğŸ’¡</div>
      <h3 style="margin:0 0 6px 0;color:#7c3aed;font-size:20px;font-weight:800">Giáº£i Tá»± Äá»™ng!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ¯ Thuáº­t toÃ¡n hoÃ n thÃ nh</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#8b5cf6" id="winAutoSolveStats"></div>
      <div class="popup-actions"><button id="winAutoSolveClose" class="btn">ğŸ” Xem láº¡i</button></div>
    </div>
  </div>

  <!-- Teach Mode Popup -->
  <div id="winTeach" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-teach">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ“</div>
      <h3 style="margin:0 0 6px 0;color:#f59e0b;font-size:20px;font-weight:800">Chá»‰ cÃ³ váº­y thÃ´i Ä‘Ã³</h3>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#d97706" id="winTeachStats"></div>
      <div class="popup-actions"><button id="winTeachClose" class="btn">Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <!-- Learn Mode  Popup -->
  <div id="winLearn" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-learn">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ§ ğŸ‘¨â€ğŸ«</div>
      <h3 style="margin:0 0 6px 0;color:#10b981;font-size:20px;font-weight:800">Há»c Xong Rá»“i!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ“š Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Learn</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#059669" id="winLearnStats"></div>
      <div class="popup-actions"><button id="winLearnClose" class="btn">ğŸ“– Tiáº¿p tá»¥c há»c</button></div>
    </div>
  </div>

  <!-- Sandbox Popup - Enhanced -->
  <div id="winSandbox" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-sandbox" style="max-width: 480px;">
      <div id="winSandboxStats" style="color:#7c3aed"></div>
      <div class="popup-actions" style="margin-top:16px;">
        <button id="winSandboxClose" class="btn" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);font-weight:800;">ğŸ§ª ThÃ­ nghiá»‡m tiáº¿p theo</button>
      </div>
    </div>
  </div>

  <div id="analysisPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="analysisTitle">
    <div class="popup-box wide">
      <h3 id="analysisTitle" style="margin-top:0">ğŸ† Best score</h3>
      <div id="leaderboardList" style="text-align:left; max-height: 320px; overflow:auto"></div>
      <div class="popup-actions"><button id="analysisClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>

  <!-- Challenge Win Popups (moved here) -->
  <div id="challengeWinEasy" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinEasyTitle">
    <div class="popup-box">
      <div id="challengeWinEasyTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ‰ ChÃºc má»«ng! (Challenge Dá»…)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Challenge (Dá»…). Tiáº¿p tá»¥c nÃ¢ng cáº¥p thá»­ thÃ¡ch nhÃ©!</p>
      <div class="popup-actions"><button id="challengeWinEasyClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  <div id="challengeWinMedium" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinMediumTitle">
    <div class="popup-box">
      <div id="challengeWinMediumTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ… Tuyá»‡t vá»i! (Challenge Vá»«a)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Challenge (Vá»«a). HÃ£y chinh phá»¥c má»©c KhÃ³!</p>
      <div class="popup-actions"><button id="challengeWinMediumClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  <div id="challengeWinHard" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinHardTitle">
    <div class="popup-box">
      <div id="challengeWinHardTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ¥‡ Äá»‰nh cao! (Challenge KhÃ³)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ chinh phá»¥c Challenge (KhÃ³)! ThÃ nh tÃ­ch ráº¥t áº¥n tÆ°á»£ng!</p>
      <div class="popup-actions"><button id="challengeWinHardClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  
  <div id="challengeDifficultyPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeTitle">
      <div class="popup-box">
          <h3 id="challengeTitle" style="margin-top:0">Chá»n Ä‘á»™ khÃ³ Challenge</h3>
          <p style="color:var(--muted);margin:4px 0 12px;">Thá»i gian sáº½ Ä‘Æ°á»£c tÃ­nh dá»±a trÃªn sá»‘ Ä‘Ä©a.</p>
          <div class="popup-actions" style="flex-direction:column;">
              <button id="difficultyEasy" class="btn">ğŸ˜„ Dá»…</button>
              <button id="difficultyMedium" class="btn" style="background-color:#f39c12;">ğŸ˜ Vá»«a</button>
              <button id="difficultyHard" class="btn" style="background-color:#e74c3c;">ğŸ¥µ KhÃ³</button>
          </div>
      </div>
  </div>

  <div id="achievementsPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="achieveTitle">
        <div class="popup-box wide">
            <h3 id="achieveTitle" style="margin-top:0">ğŸ† ThÃ nh tÃ­ch & Danh hiá»‡u</h3>
            <p style="color:var(--muted);margin:4px 0 12px;">Má»Ÿ khÃ³a thÃ nh tÃ­ch Ä‘á»ƒ nháº­n danh hiá»‡u má»›i. Click vÃ o danh hiá»‡u Ä‘Ã£ má»Ÿ khÃ³a Ä‘á»ƒ trang bá»‹.</p>
            <div id="achievementsList" class="achievements-list">
                </div>
            <div class="popup-actions"><button id="achievementsClose" class="btn">ÄÃ³ng</button></div>
        </div>
    </div>
    
  <div id="achievementUnlockedPopup" class="finishPop" style="min-width:320px;display:flex;align-items:center;justify-content:center;flex-direction:column;"></div>

  <div id="loserPopup" class="popup" style="display:none" role="alert"><div class="popup-box"><div style="font-weight:900;font-size:20px;color:#d23"></div><div style="margin-top:12px"><button id="loserClose" class="btn">ÄÃ³ng</button></div></div></div>

  <div id="settingsPopup" class="settings-panel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" style="display:none;">
      <div id="settingsHeader" class="settings-header">
          <h3 style="margin:0;font-size:16px;flex:1;cursor:move;">âš™ï¸ CÃ i Ä‘áº·t</h3>
          <button id="settingsMinimize" class="panel-btn" title="Thu gá»n">âˆ’</button>
          <button id="settingsCloseX" class="panel-btn" title="ÄÃ³ng">Ã—</button>
      </div>
      <div class="settings-content">
          
          <!-- Background Section -->
          <div style="margin-bottom:18px;">
              <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸ¨ HÃ¬nh ná»n</h4>
              <div class="settings-grid">
                  <div class="setting-item">
                      <label for="bgImageUpload">áº¢nh ná»n Game:</label>
                      <input type="file" id="bgImageUpload" accept="image/*" class="image-upload">
                      <span id="bgImageStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
                  </div>
                  <div class="setting-item">
                      <label for="bgOpacity">Äá»™ má» ná»n:</label>
                      <input type="range" id="bgOpacity" min="0" max="100" value="100" style="width:100%">
                      <span id="bgOpacityValue" class="upload-status">100%</span>
                  </div>
              </div>
          </div>
          
          <!-- Audio Section -->
          <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸµ Ã‚m thanh</h4>
          <div class="settings-grid">
              <div class="setting-item">
                  <label for="bgmUpload">Nháº¡c ná»n (BGM):</label>
                  <input type="file" id="bgmUpload" accept="audio/*" class="audio-upload">
                  <span id="bgmUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
              <div class="setting-item">
                  <label for="pickupUpload">Ã‚m thanh Nháº¥c Ä‘Ä©a:</label>
                  <input type="file" id="pickupUpload" accept="audio/*" class="audio-upload">
                  <span id="pickupUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="dropUpload">Ã‚m thanh Äáº·t Ä‘Ä©a:</label>
                  <input type="file" id="dropUpload" accept="audio/*" class="audio-upload">
                  <span id="dropUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="winUpload">Ã‚m thanh Chiáº¿n tháº¯ng:</label>
                  <input type="file" id="winUpload" accept="audio/*" class="audio-upload">
                  <span id="winUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
          </div>
          
          <!-- Cache Cleaner -->
          <div style="margin-top:20px;border-top:1px solid rgba(0,0,0,0.08);padding-top:16px;">
              <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸ—‘ï¸ Quáº£n lÃ½ Bá»™ nhá»›</h4>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                  <button id="clearCache" class="ghost" style="flex:1;min-width:140px;font-size:12px;padding:6px 10px;">xÃ³a bá»™ nhá»› Ä‘á»‡m</button>
                  <button id="clearAllData" class="ghost" style="flex:1;min-width:140px;border-color:#dc2626;color:#dc2626;font-weight:900;font-size:11px;padding:6px 10px;">XÃ“A TOÃ€N Bá»˜ Dá»® LIá»†U</button>
              </div>
              <p style="color:var(--muted);font-size:11px;margin:6px 0 0 0;">âš ï¸ XÃ³a toÃ n bá»™ sáº½ xÃ³a achievements, best scores</p>
          </div>
          
          <div class="settings-footer">
              <button id="settingsReset" class="ghost" style="border-color:#e74c3c; color:#e74c3c;font-size:12px;padding:6px 10px;">KhÃ´i phá»¥c Máº·c Ä‘á»‹nh</button>
          </div>
      </div>
  </div>


  <audio id="bgm" loop preload="auto" data-default-src="smooth-gaming-atmosphere-323659.mp3">
    <source src="smooth-gaming-atmosphere-323659.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="snd_pickup" preload="auto" data-default-src="pop-402324.mp3?filename=pop-402324.mp3">
    <source src="pop-402324.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_drop" preload="auto" data-default-src="beep-329314.mp3">
    <source src="beep-329314.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_error" preload="auto" data-default-src="error-126627.mp3">
    <source src="error-126627.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_win" preload="auto" data-default-src="votay.mp3">
    <source src="votay.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_fireworks" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3" type="audio/mpeg">
  </audio>

  <div id="learnPanel" style="display:none">
    <div class="learn-header" id="learnHeader">
      <div class="learn-header-title">
        <span>ğŸ“š</span>
        <span>Learn Mode</span>
        <span style="font-size:11px;font-weight:600;opacity:0.9">n=<span id="learnN">4</span></span>
      </div>
      <div class="learn-header-actions">
        <button class="learn-collapse-btn" id="learnCollapseBtn" title="Thu gá»n (C)">âˆ’</button>
        <button class="learn-close-btn" id="learnCloseBtn" title="ÄÃ³ng (X)">âœ•</button>
      </div>
    </div>
    
    <div class="learn-content">
      <!-- Progress Bar -->
      <div class="learn-progress-container">
        <div class="learn-progress-bar" id="learnProgressBar"></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div class="learn-step-counter" id="learnStepCounter">BÆ°á»›c 0/0</div>
        <div class="learn-complexity" id="learnComplexity">O(2â¿)</div>
      </div>
      
      <div id="pseudoCodeArea">
        <div class="code-line" data-line="0"><b>Hanoi</b>(k, from, to, aux):</div>
        <div class="code-line" data-line="1" style="padding-left: 1em;">IF k > 0 THEN</div>
        <div class="code-line" data-line="2" style="padding-left: 2em;">Hanoi(k-1, from, aux, to)</div>
        <div class="code-line" data-line="3" style="padding-left: 2em;">Move disk k from <b>from</b> to <b>to</b></div>
        <div class="code-line" data-line="4" style="padding-left: 2em;">Hanoi(k-1, aux, to, from)</div>
        <div class="code-line" data-line="5" style="padding-left: 1em;">END IF</div>
    </div>
    
    <div id="stackArea"></div>
    <div id="learnExplain"></div>
    <div style="display:flex;gap:8px;margin-top:10px;justify-content:center">
      <button id="learnPrev" class="ghost" title="Previous (â†)">â—€ Prev</button>
      <button id="learnPlay" class="btn" title="Play (Space)">â–¶ Play</button>
      <button id="learnPause" class="ghost" style="display:none" title="Pause (Space)">â¸ Pause</button>
      <button id="learnNext" class="ghost" title="Next (â†’)">Next â–¶</button>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:12px">
      <label style="font-size:13px;color:var(--muted);flex:1">Speed:
        <select id="learnSpeed" class="speed-select"><option value="1200">Slow</option><option value="700" selected>Medium</option><option value="300">Fast</option></select>
      </label>
      <div style="font-size:11px;color:var(--muted);text-align:right">âŒ¨ï¸ â†â†’ Space C X</div>
    </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>
<script src="ap2.js?v=20241102031" defer></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('./service-worker.js').catch(function(){});
    });
  }
  </script>
</body>
</html>
